<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>حسابي - Dark Shop</title>
<link rel="stylesheet" href="/assets/css/style.css">
<link rel="stylesheet" href="/assets/css/account.css">
</head>
<body>

<!-- ======== Header ======== -->


<!-- ======== Account Container ======== -->
<div class="account-container">
    <div class="account-header">حسابي</div>

    <div class="account-section">
        <h3>البيانات الشخصية</h3>
        <label for="username">الاسم:</label>
        <input type="text" id="username">
        <label for="email">الإيميل:</label>
        <input type="email" id="email">
        <label for="password">كلمة المرور:</label>
        <input type="password" id="password">
        <button id="saveData">حفظ البيانات</button>
        <button id="logoutBtn" style="background:red; margin-top:10px;">تسجيل خروج</button>
    </div>

    <div class="account-section">
        <h3>الطلبات السابقة</h3>
        <div class="orders-list" id="ordersList">لا توجد طلبات بعد.</div>
    </div>
</div>

<!-- ======== JS ======== -->
<script src="/assets/js/components.js"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {

    // ====== Dropdown Menu ======
    const dropdowns = document.querySelectorAll('.dropdown');
    dropdowns.forEach(dropdown => {
        const btn = dropdown.querySelector('.dropbtn');
        if(!btn) return;

        btn.addEventListener('click', (e) => {
            e.stopPropagation(); // منع انتشار الحدث
            dropdown.classList.toggle('open');
        });
    });

    // إغلاق جميع القوائم عند الضغط خارجها
    document.addEventListener('click', () => {
        dropdowns.forEach(drop => drop.classList.remove('open'));
    });

    // ====== User Data ======
    const userData = JSON.parse(localStorage.getItem("user"));
    if(!userData){
        alert("❌ يرجى تسجيل الدخول أولًا!");
        window.location.href = "login.html";
        return;
    }

    const usernameInput = document.getElementById("username");
    const emailInput = document.getElementById("email");
    const passwordInput = document.getElementById("password");

    usernameInput.value = userData.name || "";
    emailInput.value = userData.email || "";
    passwordInput.value = userData.password || "";

    // زر حفظ البيانات
    const saveBtn = document.getElementById("saveData");
    saveBtn.addEventListener("click", () => {
        const name = usernameInput.value.trim();
        const email = emailInput.value.trim();
        const password = passwordInput.value.trim();

        if(!name || !email || !password){
            alert("يرجى ملء جميع الحقول!");
            return;
        }

        const updatedUser = {
            name, email, password,
            role: userData.role || "user"
        };
        localStorage.setItem("user", JSON.stringify(updatedUser));
        alert("✅ تم حفظ البيانات بنجاح!");
    });

    // زر تسجيل الخروج
    const logoutBtn = document.getElementById("logoutBtn");
    logoutBtn.addEventListener("click", () => {
        localStorage.removeItem("user");
        alert("✅ تم تسجيل الخروج!");
        window.location.href = "login.html";
    });

    // ====== Orders List ======
    const cart = JSON.parse(localStorage.getItem("cart")) || [];
    const ordersList = document.getElementById("ordersList");

    function displayOrders() {
        if(cart.length === 0){
            ordersList.innerHTML = "لا توجد طلبات بعد.";
            return;
        }

        ordersList.innerHTML = "";
        cart.forEach((item, index) => {
            const div = document.createElement("div");
            div.innerHTML = `
                <span>${item.name} - ${item.quantity} × ${item.price} جنيه</span>
                <button data-index="${index}" class="deleteOrder">حذف</button>
            `;
            ordersList.appendChild(div);
        });

        // إضافة حدث حذف لكل زر
        const deleteButtons = document.querySelectorAll(".deleteOrder");
        deleteButtons.forEach(btn => {
            btn.addEventListener("click", (e) => {
                const i = e.target.dataset.index;
                cart.splice(i, 1);
                localStorage.setItem("cart", JSON.stringify(cart));
                displayOrders();
            });
        });
    }

    displayOrders();

    // ====== Show Add Product Button for Admin ======
    const addProductContainer = document.getElementById("addProductContainer");
    if(userData.role === "admin"){
        addProductContainer.style.display = "block";
    } else {
        addProductContainer.style.display = "none";
    }

});

</script>

</body>
</html>
