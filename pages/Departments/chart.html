<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>سلة التسوق - Dark Shop</title>
  <link rel="stylesheet" href="/assets/css/style.css" />
  <style>
    /* ... [نفس CSS اللي كتبته بالضبط بدون تغيير] ... */
  </style>
</head>
<body>

<!-- عنوان الصفحة -->
<section class="cart-hero">
  <h1>سلة التسوق الخاصة بك</h1>
  <p>راجع منتجاتك قبل إتمام الطلب</p>
</section>

<!-- سلة المنتجات -->
<section class="cart-container">
  <table>
    <thead>
      <tr>
        <th>صورة المنتج</th>
        <th>اسم المنتج</th>
        <th>السعر</th>
        <th>الكمية</th>
        <th>الإجمالي</th>
        <th>حذف</th>
      </tr>
    </thead>
    <tbody id="cart-items"></tbody>
  </table>

  <div class="cart-summary">
    <h3>إجمالي السلة: <span id="cart-total">0</span> جنيه</h3>
    <button id="checkout-btn">إتمام الشراء</button>
  </div>
</section>

<!-- سكريبت السلة -->
<script>
  let cart = JSON.parse(localStorage.getItem('cart')) || [];
  const cartItemsContainer = document.getElementById('cart-items');
  const cartTotal = document.getElementById('cart-total');
  const counter = document.getElementById('counter');

  function renderCart() {
    cartItemsContainer.innerHTML = '';
    let total = 0;

    cart.forEach((item, index) => {
      const itemTotal = item.price * item.quantity;
      total += itemTotal;

      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><img src="${item.image}" alt="${item.name}"></td>
        <td>${item.name}</td>
        <td>${item.price}</td>
        <td><input type="number" min="1" value="${item.quantity}" data-index="${index}" class="quantity-input"></td>
        <td>${itemTotal}</td>
        <td><button data-index="${index}" class="remove-btn">حذف</button></td>
      `;
      cartItemsContainer.appendChild(tr);
    });

    cartTotal.textContent = total;
    if (counter) {
      counter.textContent = cart.reduce((acc, item) => acc + item.quantity, 0);
    }

    attachEvents();
  }

  function attachEvents() {
    document.querySelectorAll('.remove-btn').forEach(btn => {
      btn.addEventListener('click', e => {
        const index = e.target.dataset.index;
        cart.splice(index, 1);
        localStorage.setItem('cart', JSON.stringify(cart));
        renderCart();
      });
    });

    document.querySelectorAll('.quantity-input').forEach(input => {
      input.addEventListener('change', e => {
        const index = e.target.dataset.index;
        const value = parseInt(e.target.value);
        cart[index].quantity = value > 0 ? value : 1;
        localStorage.setItem('cart', JSON.stringify(cart));
        renderCart();
      });
    });

    document.getElementById('checkout-btn').addEventListener('click', () => {
      if (cart.length === 0) {
        alert("السلة فارغة!");
        return;
      }

      const date = new Date().toLocaleString();
      let confirmedOrders = JSON.parse(localStorage.getItem('confirmedOrders')) || [];

      cart.forEach(item => {
        confirmedOrders.push({
          name: item.name,
          price: item.price,
          quantity: item.quantity,
          image: item.image,
          date: date
        });
      });

      localStorage.setItem('confirmedOrders', JSON.stringify(confirmedOrders));
      cart = [];
      localStorage.setItem('cart', JSON.stringify(cart));
      alert("تم إتمام الشراء بنجاح! يمكنك مراجعة طلبك في صفحة الطلبات المؤكدة.");
      renderCart();
    });
  }

  document.addEventListener("DOMContentLoaded", renderCart);
</script>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script src="/assets/js/components.js"></script>

</body>
</html>